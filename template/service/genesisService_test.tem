package mallservice

import (
	"aibite/mall/mall-api/common"
	"fmt"
	"testing"

	"github.com/akkagao/goutil"
)

func InitTestEnv() {
	common.InitConfig("../../api/resources/conf-dev.yaml")
	StartDb()
	StartRedis()
	StartService()
}

func Test_genesisService_Save(t *testing.T) {
	InitTestEnv()
	genesis := Genesis{
		Name:  "CrazyWolf2",
		Phone: "123",
	}
	ok := GenesisService.Save(&genesis)
	fmt.Println(ok, genesis.Id)
}

func Test_genesisService_GetById(t *testing.T) {
	InitTestEnv()
	genesis := GenesisService.GetById(1)
	fmt.Println(genesis.IsDel())
	fmt.Println(goutil.JsonMarshal(genesis))
}

func Test_genesisService_GetByIds(t *testing.T) {
	InitTestEnv()
	genesisList := GenesisService.GetByIds([]int{1, 2, 3})
	fmt.Println(goutil.JsonMarshal(genesisList))
}

func Test_genesisService_Count(t *testing.T) {
	InitTestEnv()
	fmt.Println(GenesisService.Count())
}

func Test_genesisService_DeleteById(t *testing.T) {
	InitTestEnv()
	GenesisService.DeleteById(1)
	genesis := GenesisService.GetById(1)
	fmt.Println(goutil.JsonMarshal(genesis))
	fmt.Println(genesis.IsDel())
}

func Test_genesisService_Update(t *testing.T) {
	InitTestEnv()
	genesis := GenesisService.GetById(2)
	genesis.Name = "test"
	genesis.Address = "new Address"
	GenesisService.Update(genesis, goutil.SnakeStrings("Name", "Address")...)
	genesisNew := GenesisService.GetById(2)
	fmt.Println(goutil.JsonMarshal(genesisNew))
}
